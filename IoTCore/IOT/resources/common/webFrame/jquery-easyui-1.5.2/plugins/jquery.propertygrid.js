/**
 * jQuery EasyUI 1.5.2
 * 
 * Copyright (c) 2009-2017 www.jeasyui.com. All rights reserved.
 *
 * Licensed under the freeware license: http://www.jeasyui.com/license_freeware.php
 * To use it on other terms please contact us: info@jeasyui.com
 *
 */
(function(c){function u(b){c.data(b,"propertygrid");var a=c.data(b,"propertygrid").options;c(b).datagrid(c.extend({},a,{cls:"propertygrid",view:a.showGroup?a.groupView:a.view,onBeforeEdit:function(d,e){if(0==a.onBeforeEdit.call(b,d,e))return!1;var h=c(this);e=h.datagrid("getRows")[d];h.datagrid("getColumnOption","value").editor=e.editor},onClickCell:function(d,e,h){n!=this&&(p(n),n=this);if(a.editIndex!=d){p(n);c(this).datagrid("beginEdit",d);var f=c(this).datagrid("getEditor",{index:d,field:e});f||(f=c(this).datagrid("getEditor",{index:d,field:"value"}));f&&(f=c(f.target),(f.data("textbox")?f.textbox("textbox"):f).focus(),a.editIndex=d)}a.onClickCell.call(b,d,e,h)},loadFilter:function(b){p(this);return a.loadFilter.call(this,b)}}))}function p(b){var a=c(b);if(a.length){var d=c.data(b,"propertygrid").options;d.finder.getTr(b,null,"editing").each(function(){var b=parseInt(c(this).attr("datagrid-row-index"));a.datagrid("validateRow",b)?a.datagrid("endEdit",b):a.datagrid("cancelEdit",b)});d.editIndex=void 0}}var n;c(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(b){c(b.target).closest("div.datagrid-view,div.combo-panel").length||(p(n),n=void 0)});c.fn.propertygrid=function(b,a){if("string"==typeof b){var d=c.fn.propertygrid.methods[b];return d?d(this,a):this.datagrid(b,a)}b=b||{};return this.each(function(){var a=c.data(this,"propertygrid");a?c.extend(a.options,b):(a=c.extend({},c.fn.propertygrid.defaults,c.fn.propertygrid.parseOptions(this),b),a.frozenColumns=c.extend(!0,[],a.frozenColumns),a.columns=c.extend(!0,[],a.columns),c.data(this,"propertygrid",{options:a}));u(this)})};c.fn.propertygrid.methods={options:function(b){return c.data(b[0],"propertygrid").options}};c.fn.propertygrid.parseOptions=function(b){return c.extend({},c.fn.datagrid.parseOptions(b),c.parser.parseOptions(b,[{showGroup:"boolean"}]))};var t=c.extend({},c.fn.datagrid.defaults.view,{render:function(b,a,d){for(var e=[],h=this.groups,f=0;f<h.length;f++)e.push(this.renderGroup.call(this,b,f,h[f],d));c(a).html(e.join(""))},renderGroup:function(b,a,d,e){var h=c.data(b,"datagrid"),f=h.options,m=c(b).datagrid("getColumnFields",e),g=[];g.push('\x3cdiv class\x3d"datagrid-group" group-index\x3d'+a+"\x3e");if(e&&(f.rownumbers||f.frozenColumns.length)||!e&&!f.rownumbers&&!f.frozenColumns.length)g.push('\x3cspan class\x3d"datagrid-group-expander"\x3e'),g.push('\x3cspan class\x3d"datagrid-row-expander datagrid-row-collapse"\x3e\x26nbsp;\x3c/span\x3e'),g.push("\x3c/span\x3e");e||(g.push('\x3cspan class\x3d"datagrid-group-title"\x3e'),g.push(f.groupFormatter.call(b,d.value,d.rows)),g.push("\x3c/span\x3e"));g.push("\x3c/div\x3e");g.push('\x3ctable class\x3d"datagrid-btable" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\x3ctbody\x3e');a=d.startIndex;for(var k=0;k<d.rows.length;k++){var l=f.rowStyler?f.rowStyler.call(b,a,d.rows[k]):"",r="",q="";"string"==typeof l?q=l:l&&(r=l["class"]||"",q=l.style||"");g.push('\x3ctr id\x3d"'+(h.rowIdPrefix+"-"+(e?1:2)+"-"+a)+'" datagrid-row-index\x3d"'+a+'" '+('class\x3d"datagrid-row '+(a%2&&f.striped?"datagrid-row-alt ":" ")+r+'"')+" "+(q?'style\x3d"'+q+'"':"")+"\x3e");g.push(this.renderRow.call(this,b,m,e,a,d.rows[k]));g.push("\x3c/tr\x3e");a++}g.push("\x3c/tbody\x3e\x3c/table\x3e");return g.join("")},bindEvents:function(b){var a=c.data(b,"datagrid").dc,a=a.body1.add(a.body2),d=(c.data(a[0],"events")||c._data(a[0],"events")).click[0].handler;a.unbind("click").bind("click",function(a){var e=c(a.target).closest("span.datagrid-row-expander");if(e.length){var f=e.closest("div.datagrid-group").attr("group-index");e.hasClass("datagrid-row-collapse")?c(b).datagrid("collapseGroup",f):c(b).datagrid("expandGroup",f)}else d(a);a.stopPropagation()})},onBeforeRender:function(b,a){function d(a){for(var b=0;b<f.length;b++){var c=f[b];if(c.value==a)return c}return null}var e=c.data(b,"datagrid"),h=e.options;c("#datagrid-group-style").length||c("head").append('\x3cstyle id\x3d"datagrid-group-style"\x3e.datagrid-group{height:'+h.groupHeight+"px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;}.datagrid-group-title,.datagrid-group-expander{display:inline-block;vertical-align:bottom;height:100%;line-height:"+h.groupHeight+"px;padding:0 4px;}.datagrid-group-expander{width:"+h.expanderWidth+"px;text-align:center;padding:0}.datagrid-row-expander{margin:"+Math.floor((h.groupHeight-16)/2)+"px 0;display:inline-block;width:16px;height:16px;cursor:pointer}\x3c/style\x3e");for(var f=[],m=0;m<a.length;m++){var g=a[m],k=d(g[h.groupField]);k?k.rows.push(g):(k={value:g[h.groupField],rows:[g]},f.push(k))}h=0;g=[];for(m=0;m<f.length;m++)k=f[m],k.startIndex=h,h+=k.rows.length,g=g.concat(k.rows);e.data.rows=g;this.groups=f;var l=this;setTimeout(function(){l.bindEvents(b)},0)}});c.extend(c.fn.datagrid.methods,{groups:function(b){return b.datagrid("options").view.groups},expandGroup:function(b,a){return b.each(function(){var b=c.data(this,"datagrid").dc.view.find(void 0!=a?'div.datagrid-group[group-index\x3d"'+a+'"]':"div.datagrid-group"),e=b.find("span.datagrid-row-expander");e.hasClass("datagrid-row-expand")&&(e.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),b.next("table").show());c(this).datagrid("fixRowHeight")})},collapseGroup:function(b,a){return b.each(function(){var b=c.data(this,"datagrid").dc.view.find(void 0!=a?'div.datagrid-group[group-index\x3d"'+a+'"]':"div.datagrid-group"),e=b.find("span.datagrid-row-expander");e.hasClass("datagrid-row-collapse")&&(e.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),b.next("table").hide());c(this).datagrid("fixRowHeight")})}});c.extend(t,{refreshGroupTitle:function(b,a){var d=c.data(b,"datagrid"),e=d.options,h=this.groups[a];d.dc.body2.children("div.datagrid-group[group-index\x3d"+a+"]").find("span.datagrid-group-title").html(e.groupFormatter.call(b,h.value,h.rows))},insertRow:function(b,a,d){function e(a,c){var d=c?1:2,e=f.finder.getTr(b,a-1,"body",d);f.finder.getTr(b,a,"body",d).insertAfter(e)}var h=c.data(b,"datagrid"),f=h.options,m=h.dc,g=null,k;if(h.data.rows.length){for(var l=0;l<this.groups.length;l++)if(this.groups[l].value==d[f.groupField]){g=this.groups[l];k=l;break}if(g){if(void 0==a||null==a)a=h.data.rows.length;a<g.startIndex?a=g.startIndex:a>g.startIndex+g.rows.length&&(a=g.startIndex+g.rows.length);c.fn.datagrid.defaults.view.insertRow.call(this,b,a,d);a>=g.startIndex+g.rows.length&&(e(a,!0),e(a,!1));g.rows.splice(a-g.startIndex,0,d)}else g={value:d[f.groupField],rows:[d],startIndex:h.data.rows.length},k=this.groups.length,m.body1.append(this.renderGroup.call(this,b,k,g,!0)),m.body2.append(this.renderGroup.call(this,b,k,g,!1)),this.groups.push(g),h.data.rows.push(d);this.refreshGroupTitle(b,k)}else c(b).datagrid("loadData",[d])},updateRow:function(b,a,d){var e=c.data(b,"datagrid").options;c.fn.datagrid.defaults.view.updateRow.call(this,b,a,d);a=e.finder.getTr(b,a,"body",2).closest("table.datagrid-btable");a=parseInt(a.prev().attr("group-index"));this.refreshGroupTitle(b,a)},deleteRow:function(b,a){var d=c.data(b,"datagrid"),e=d.options,d=d.dc,d=d.body1.add(d.body2),e=e.finder.getTr(b,a,"body",2).closest("table.datagrid-btable"),e=parseInt(e.prev().attr("group-index"));c.fn.datagrid.defaults.view.deleteRow.call(this,b,a);var h=this.groups[e];if(1<h.rows.length)h.rows.splice(a-h.startIndex,1),this.refreshGroupTitle(b,e);else{d.children("div.datagrid-group[group-index\x3d"+e+"]").remove();for(var f=e+1;f<this.groups.length;f++)d.children("div.datagrid-group[group-index\x3d"+f+"]").attr("group-index",f-1);this.groups.splice(e,1)}for(f=a=0;f<this.groups.length;f++)h=this.groups[f],h.startIndex=a,a+=h.rows.length}});c.fn.propertygrid.defaults=c.extend({},c.fn.datagrid.defaults,{groupHeight:21,expanderWidth:16,singleSelect:!0,remoteSort:!1,fitColumns:!0,loadMsg:"",frozenColumns:[[{field:"f",width:16,resizable:!1}]],columns:[[{field:"name",title:"Name",width:100,sortable:!0},{field:"value",title:"Value",width:100,resizable:!1}]],showGroup:!1,groupView:t,groupField:"group",groupFormatter:function(b,a){return b}})})(jQuery);