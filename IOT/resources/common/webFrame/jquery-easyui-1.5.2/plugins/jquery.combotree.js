/**
 * jQuery EasyUI 1.5.2
 * 
 * Copyright (c) 2009-2017 www.jeasyui.com. All rights reserved.
 *
 * Licensed under the freeware license: http://www.jeasyui.com/license_freeware.php
 * To use it on other terms please contact us: info@jeasyui.com
 *
 */
(function(b){function p(a){var c=b.data(a,"combotree"),e=c.options,d=c.tree;b(a).addClass("combotree-f");b(a).combo(b.extend({},e,{onShowPanel:function(){e.editable&&d.tree("doFilter","");e.onShowPanel.call(this)}}));var f=b(a).combo("panel");d||(d=b("\x3cul\x3e\x3c/ul\x3e").appendTo(f),c.tree=d);d.tree(b.extend({},e,{checkbox:e.multiple,onLoadSuccess:function(f,h){var g=b(a).combotree("getValues");e.multiple&&b.map(d.tree("getChecked"),function(a){b.easyui.addArrayItem(g,a.id)});k(a,g,c.remainText);e.onLoadSuccess.call(this,f,h)},onClick:function(d){e.multiple?b(this).tree(d.checked?"uncheck":"check",d.target):b(a).combo("hidePanel");c.remainText=!1;m(a);e.onClick.call(this,d)},onCheck:function(b,d){c.remainText=!1;m(a);e.onCheck.call(this,b,d)}}))}function m(a){var c=b.data(a,"combotree"),e=c.options,d=c.tree,f=[];e.multiple?f=b.map(d.tree("getChecked"),function(b){return b.id}):(d=d.tree("getSelected"))&&f.push(d.id);f=f.concat(e.unselectedValues);k(a,f,c.remainText)}function k(a,c,e){function d(a,c){var d=b.easyui.getArrayItem(c,"id",a);return d?d[g.textField||""]||d.text:void 0}var f=b.data(a,"combotree"),g=f.options,h=f.tree,f=h.tree("options"),k=f.onBeforeCheck,m=f.onCheck,p=f.onSelect;f.onBeforeCheck=f.onCheck=f.onSelect=function(){};b.isArray(c)||(c=c.split(g.separator));g.multiple||(c=c.length?[c[0]]:[""]);var l=b.map(c,function(b){return String(b)});h.find("div.tree-node-selected").removeClass("tree-node-selected");b.map(h.tree("getChecked"),function(a){-1==b.inArray(String(a.id),l)&&h.tree("uncheck",a.target)});var n=[];g.unselectedValues=[];b.map(l,function(b){var a=h.tree("find",b);a?(h.tree("check",a.target).tree("select",a.target),n.push(a[g.textField||""]||a.text)):(n.push(d(b,g.mappingRows)||b),g.unselectedValues.push(b))});g.multiple&&b.map(h.tree("getChecked"),function(a){var c=String(a.id);-1==b.inArray(c,l)&&(l.push(c),n.push(a[g.textField||""]||a.text))});f.onBeforeCheck=k;f.onCheck=m;f.onSelect=p;e||(c=n.join(g.separator),b(a).combo("getText")!=c&&b(a).combo("setText",c));b(a).combo("setValues",l)}b.fn.combotree=function(a,c){if("string"==typeof a){var e=b.fn.combotree.methods[a];return e?e(this,c):this.combo(a,c)}a=a||{};return this.each(function(){var c=b.data(this,"combotree");c?b.extend(c.options,a):b.data(this,"combotree",{options:b.extend({},b.fn.combotree.defaults,b.fn.combotree.parseOptions(this),a)});p(this)})};b.fn.combotree.methods={options:function(a){var c=a.combo("options");return b.extend(b.data(a[0],"combotree").options,{width:c.width,height:c.height,originalValue:c.originalValue,disabled:c.disabled,readonly:c.readonly})},clone:function(a,c){var e=a.combo("clone",c);e.data("combotree",{options:b.extend(!0,{},a.combotree("options")),tree:a.combotree("tree")});return e},tree:function(a){return b.data(a[0],"combotree").tree},loadData:function(a,c){return a.each(function(){b.data(this,"combotree").options.data=c;b.data(this,"combotree").tree.tree("loadData",c)})},reload:function(a,c){return a.each(function(){var a=b.data(this,"combotree").options,d=b.data(this,"combotree").tree;c&&(a.url=c);d.tree({url:a.url})})},setValues:function(a,c){return a.each(function(){var a=b(this).combotree("options");b.isArray(c)&&(c=b.map(c,function(c){return c&&"object"==typeof c?(b.easyui.addArrayItem(a.mappingRows,"id",c),c.id):c}));k(this,c)})},setValue:function(a,c){return a.each(function(){b(this).combotree("setValues",b.isArray(c)?c:[c])})},clear:function(a){return a.each(function(){b(this).combotree("setValues",[])})},reset:function(a){return a.each(function(){var a=b(this).combotree("options");a.multiple?b(this).combotree("setValues",a.originalValue):b(this).combotree("setValue",a.originalValue)})}};b.fn.combotree.parseOptions=function(a){return b.extend({},b.fn.combo.parseOptions(a),b.fn.tree.parseOptions(a))};b.fn.combotree.defaults=b.extend({},b.fn.combo.defaults,b.fn.tree.defaults,{editable:!1,textField:null,unselectedValues:[],mappingRows:[],keyHandler:{up:function(a){},down:function(a){},left:function(a){},right:function(a){},enter:function(a){b.data(this,"combotree").remainText=!1;b(this).combotree("setValues",b(this).combotree("getValues"));b(this).combotree("hidePanel")},query:function(a,c){var e=b.data(this,"combotree"),d=e.options,f=e.tree;e.remainText=!0;f.tree("doFilter",d.multiple?a.split(d.separator):a)}}})})(jQuery);