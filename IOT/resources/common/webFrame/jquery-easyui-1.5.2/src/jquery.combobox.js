/**
 * jQuery EasyUI 1.5.2
 * 
 * Copyright (c) 2009-2017 www.jeasyui.com. All rights reserved.
 *
 * Licensed under the freeware license: http://www.jeasyui.com/license_freeware.php
 * To use it on other terms please contact us: info@jeasyui.com
 *
 */
/**
 * combobox - jQuery EasyUI
 * 
 * Dependencies:
 *   combo
 * 
 */
(function(c){function u(a,b){var e=c.data(a,"combobox");return c.easyui.indexOfArray(e.data,e.options.valueField,b)}function w(a,b){var e=c.data(a,"combobox").options,d=c(a).combobox("panel"),f=d.children("div.combobox-item-hover");f.length||(f=d.children("div.combobox-item-selected"));f.removeClass("combobox-item-hover");f.length?"next"==b?(f=f.nextAll("div.combobox-item:visible:not(.combobox-item-disabled):first"),f.length||(f=d.children("div.combobox-item:visible:not(.combobox-item-disabled):first"))):(f=f.prevAll("div.combobox-item:visible:not(.combobox-item-disabled):first"),f.length||(f=d.children("div.combobox-item:visible:not(.combobox-item-disabled):last"))):f=d.children("next"==b?"div.combobox-item:visible:not(.combobox-item-disabled):first":"div.combobox-item:visible:not(.combobox-item-disabled):last");f.length&&(f.addClass("combobox-item-hover"),d=e.finder.getRow(a,f))&&(c(a).combobox("scrollTo",d[e.valueField]),e.selectOnNavigation&&r(a,d[e.valueField]))}function r(a,b,e){var d=c.data(a,"combobox").options,f=c(a).combo("getValues");-1==c.inArray(b+"",f)&&(d.multiple?f.push(b):f=[b],h(a,f,e))}function x(a,b){c.data(a,"combobox");var e=c(a).combo("getValues"),d=c.inArray(b+"",e);0<=d&&(e.splice(d,1),h(a,e))}function h(a,b,e){var d=c.data(a,"combobox").options,f=c(a).combo("panel");c.isArray(b)||(b=b.split(d.separator));d.multiple||(b=b.length?[b[0]]:[""]);var g=c(a).combo("getValues");f.is(":visible")&&f.find(".combobox-item-selected").each(function(){var b=d.finder.getRow(a,c(this));b&&-1==c.easyui.indexOfArray(g,b[d.valueField])&&c(this).removeClass("combobox-item-selected")});c.map(g,function(e){if(-1==c.easyui.indexOfArray(b,e)){var f=d.finder.getEl(a,e);f.hasClass("combobox-item-selected")&&(f.removeClass("combobox-item-selected"),d.onUnselect.call(a,d.finder.getRow(a,e)))}});for(var l=null,k=[],q=[],h=0;h<b.length;h++){var m=b[h],y=m,t=d.finder.getRow(a,m);if(t){var y=t[d.textField],l=t,z=d.finder.getEl(a,m);z.hasClass("combobox-item-selected")||(z.addClass("combobox-item-selected"),d.onSelect.call(a,t))}k.push(m);q.push(y)}e||c(a).combo("setText",q.join(d.separator));d.showItemIcon&&(e=c(a).combobox("textbox"),e.removeClass("textbox-bgicon "+d.textboxIconCls),l&&l.iconCls&&(e.addClass("textbox-bgicon "+l.iconCls),d.textboxIconCls=l.iconCls));c(a).combo("setValues",k);f.triggerHandler("scroll")}function n(a,b,e){var d=c.data(a,"combobox"),f=d.options;d.data=f.loadFilter.call(a,b);f.view.render.call(f.view,a,c(a).combo("panel"),d.data);var g=c(a).combobox("getValues");c.easyui.forEach(d.data,!1,function(a){a.selected&&c.easyui.addArrayItem(g,a[f.valueField]+"")});f.multiple?h(a,g,e):h(a,g.length?[g[g.length-1]]:[],e);f.onLoadSuccess.call(a,b)}function p(a,b,e,d){var f=c.data(a,"combobox").options;b&&(f.url=b);e=c.extend({},f.queryParams,e||{});0!=f.onBeforeLoad.call(a,e)&&f.loader.call(a,e,function(b){n(a,b,d)},function(){f.onLoadError.apply(this,arguments)})}function B(a,b){function e(c){f.reversed?g.addClass("combobox-item-hover"):h(a,f.multiple?b?c:[]:c,!0)}var d=c.data(a,"combobox"),f=d.options,g=c(),l=f.multiple?b.split(f.separator):[b];if("remote"==f.mode)e(l),p(a,null,{q:b},!0);else{var k=c(a).combo("panel");k.find(".combobox-item-hover").removeClass("combobox-item-hover");k.find(".combobox-item,.combobox-group").hide();var q=d.data,n=[];c.map(l,function(b){var e=b=c.trim(b),d=void 0;g=c();for(var l=0;l<q.length;l++){var k=q[l];if(f.filter.call(a,b,k)){var h=k[f.valueField],m=k[f.textField],k=k[f.groupField],p=f.finder.getEl(a,h).show();m.toLowerCase()==b.toLowerCase()&&(e=h,f.reversed?g=p:r(a,h,!0));f.groupField&&d!=k&&(f.finder.getGroupEl(a,k).show(),d=k)}}n.push(e)});e(n)}}function A(a){var b=c(a),e=b.combobox("options"),d=b.combobox("panel").children("div.combobox-item-hover");if(d.length){d.removeClass("combobox-item-hover");var f=e.finder.getRow(a,d)[e.valueField];e.multiple?d.hasClass("combobox-item-selected")?b.combobox("unselect",f):b.combobox("select",f):b.combobox("select",f)}var g=[];c.map(b.combobox("getValues"),function(b){0<=u(a,b)&&g.push(b)});b.combobox("setValues",g);e.multiple||b.combobox("hidePanel")}function C(a){var b=c.data(a,"combobox").options;c(a).addClass("combobox-f");c(a).combo(c.extend({},b,{onShowPanel:function(){c(this).combo("panel").find("div.combobox-item:hidden,div.combobox-group:hidden").show();h(this,c(this).combobox("getValues"),!0);c(this).combobox("scrollTo",c(this).combobox("getValue"));b.onShowPanel.call(this)}}));var e=c(a).combo("panel");e.unbind(".combobox");for(var d in b.panelEvents)e.bind(d+".combobox",{target:a},b.panelEvents[d])}c.fn.combobox=function(a,b){if("string"==typeof a){var e=c.fn.combobox.methods[a];return e?e(this,b):this.combo(a,b)}a=a||{};return this.each(function(){var b=c.data(this,"combobox");b?c.extend(b.options,a):b=c.data(this,"combobox",{options:c.extend({},c.fn.combobox.defaults,c.fn.combobox.parseOptions(this),a),data:[]});C(this);b.options.data?n(this,b.options.data):(b=c.fn.combobox.parseData(this),b.length&&n(this,b));p(this)})};c.fn.combobox.methods={options:function(a){var b=a.combo("options");return c.extend(c.data(a[0],"combobox").options,{width:b.width,height:b.height,originalValue:b.originalValue,disabled:b.disabled,readonly:b.readonly})},cloneFrom:function(a,b){return a.each(function(){c(this).combo("cloneFrom",b);c.data(this,"combobox",c(b).data("combobox"));c(this).addClass("combobox-f").attr("comboboxName",c(this).attr("textboxName"))})},getData:function(a){return c.data(a[0],"combobox").data},setValues:function(a,b){return a.each(function(){h(this,b)})},setValue:function(a,b){return a.each(function(){h(this,c.isArray(b)?b:[b])})},clear:function(a){return a.each(function(){h(this,[])})},reset:function(a){return a.each(function(){var a=c(this).combobox("options");a.multiple?c(this).combobox("setValues",a.originalValue):c(this).combobox("setValue",a.originalValue)})},loadData:function(a,b){return a.each(function(){n(this,b)})},reload:function(a,b){return a.each(function(){"string"==typeof b?p(this,b):(b&&(c(this).combobox("options").queryParams=b),p(this))})},select:function(a,b){return a.each(function(){r(this,b)})},unselect:function(a,b){return a.each(function(){x(this,b)})},scrollTo:function(a,b){return a.each(function(){var a=c.data(this,"combobox").options,d=c(this).combo("panel"),a=a.finder.getEl(this,b);a.length&&(0>=a.position().top?(a=d.scrollTop()+a.position().top,d.scrollTop(a)):a.position().top+a.outerHeight()>d.height()&&(a=d.scrollTop()+a.position().top+a.outerHeight()-d.height(),d.scrollTop(a)));d.triggerHandler("scroll")})}};c.fn.combobox.parseOptions=function(a){c(a);return c.extend({},c.fn.combo.parseOptions(a),c.parser.parseOptions(a,["valueField","textField","groupField","groupPosition","mode","method","url",{showItemIcon:"boolean",limitToList:"boolean"}]))};c.fn.combobox.parseData=function(a){function b(a,b){var f=c(a),g={};g[d.valueField]=void 0!=f.attr("value")?f.attr("value"):f.text();g[d.textField]=f.text();g.selected=f.is(":selected");g.disabled=f.is(":disabled");b&&(d.groupField=d.groupField||"group",g[d.groupField]=b);e.push(g)}var e=[],d=c(a).combobox("options");c(a).children().each(function(){if("optgroup"==this.tagName.toLowerCase()){var a=c(this).attr("label");c(this).children().each(function(){b(this,a)})}else b(this)});return e};var v=0;c.fn.combobox.defaults=c.extend({},c.fn.combo.defaults,{valueField:"value",textField:"text",groupPosition:"static",groupField:null,groupFormatter:function(a){return a},mode:"local",method:"post",url:null,data:null,queryParams:{},showItemIcon:!1,limitToList:!1,view:{render:function(a,b,e){var d=c.data(a,"combobox"),f=d.options;v++;d.itemIdPrefix="_easyui_combobox_i"+v;d.groupIdPrefix="_easyui_combobox_g"+v;d.groups=[];for(var g=[],l=void 0,k=0;k<e.length;k++){var h=e[k],n=h[f.textField],m=h[f.groupField];m?l!=m?(l=m,d.groups.push({value:m,startIndex:k,count:1}),g.push('\x3cdiv id\x3d"'+(d.groupIdPrefix+"_"+(d.groups.length-1))+'" class\x3d"combobox-group"\x3e'),g.push(f.groupFormatter?f.groupFormatter.call(a,m):m),g.push("\x3c/div\x3e")):d.groups[d.groups.length-1].count++:l=void 0;g.push('\x3cdiv id\x3d"'+(d.itemIdPrefix+"_"+k)+'" class\x3d"'+("combobox-item"+(h.disabled?" combobox-item-disabled":"")+(m?" combobox-gitem":""))+'"\x3e');f.showItemIcon&&h.iconCls&&g.push('\x3cspan class\x3d"combobox-icon '+h.iconCls+'"\x3e\x3c/span\x3e');g.push(f.formatter?f.formatter.call(a,h):n);g.push("\x3c/div\x3e")}c(b).html(g.join(""))}},keyHandler:{up:function(a){w(this,"prev");a.preventDefault()},down:function(a){w(this,"next");a.preventDefault()},left:function(a){},right:function(a){},enter:function(a){A(this)},query:function(a,b){B(this,a)}},inputEvents:c.extend({},c.fn.combo.defaults.inputEvents,{blur:function(a){var b=a.data.target,e=c(b).combobox("options");if(e.reversed||e.limitToList)e.blurTimer&&clearTimeout(e.blurTimer),e.blurTimer=setTimeout(function(){c(b).parent().length&&(e.reversed?c(b).combobox("setValues",c(b).combobox("getValues")):e.limitToList&&A(b),e.blurTimer=null)},50)}}),panelEvents:{mouseover:function(a){c(this).children("div.combobox-item-hover").removeClass("combobox-item-hover");var b=c(a.target).closest("div.combobox-item");b.hasClass("combobox-item-disabled")||b.addClass("combobox-item-hover");a.stopPropagation()},mouseout:function(a){c(a.target).closest("div.combobox-item").removeClass("combobox-item-hover");a.stopPropagation()},click:function(a){var b=c(this).panel("options").comboTarget;if(b){var e=c(b).combobox("options"),d=c(a.target).closest("div.combobox-item");if(d.length&&!d.hasClass("combobox-item-disabled")){var f=e.finder.getRow(b,d);f&&(e.blurTimer&&(clearTimeout(e.blurTimer),e.blurTimer=null),e.onClick.call(b,f),f=f[e.valueField],e.multiple?d.hasClass("combobox-item-selected")?x(b,f):r(b,f):c(b).combobox("setValue",f).combobox("hidePanel"),a.stopPropagation())}}},scroll:function(a){var b=c(this).panel("options").comboTarget;if(b){var e=c(b).combobox("options");if("sticky"==e.groupPosition){var d=c(this).children(".combobox-stick");d.length||(d=c('\x3cdiv class\x3d"combobox-stick"\x3e\x3c/div\x3e').appendTo(this));d.hide();var f=c(b).data("combobox");c(this).children(".combobox-group:visible").each(function(){var a=c(this),h=e.finder.getGroup(b,a),h=e.finder.getEl(b,f.data[h.startIndex+h.count-1][e.valueField]);if(0>a.position().top&&0<h.position().top)return d.show().html(a.html()),!1})}}}},filter:function(a,b){var e=c(this).combobox("options");return 0<=b[e.textField].toLowerCase().indexOf(a.toLowerCase())},formatter:function(a){var b=c(this).combobox("options");return a[b.textField]},loader:function(a,b,e){var d=c(this).combobox("options");if(!d.url)return!1;c.ajax({type:d.method,url:d.url,data:a,dataType:"json",success:function(a){b(a)},error:function(){e.apply(this,arguments)}})},loadFilter:function(a){return a},finder:{getEl:function(a,b){var e=u(a,b),e=c.data(a,"combobox").itemIdPrefix+"_"+e;return c("#"+e)},getGroupEl:function(a,b){var e=c.data(a,"combobox"),d=c.easyui.indexOfArray(e.groups,"value",b);return c("#"+(e.groupIdPrefix+"_"+d))},getGroup:function(a,b){var e=c.data(a,"combobox"),d=b.attr("id").substr(e.groupIdPrefix.length+1);return e.groups[parseInt(d)]},getRow:function(a,b){var e=c.data(a,"combobox"),d=b instanceof c?b.attr("id").substr(e.itemIdPrefix.length+1):u(a,b);return e.data[parseInt(d)]}},onBeforeLoad:function(a){},onLoadSuccess:function(a){},onLoadError:function(){},onSelect:function(a){},onUnselect:function(a){},onClick:function(a){}})})(jQuery);